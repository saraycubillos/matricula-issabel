<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Matrícula Biblioteca</title>
  <script>
    let usuarioActual = null;
    let cursosDisponibles = [];

    function consultarCursos() {
      const documento = document.getElementById("documento").value.trim();
      if (!documento) {
        alert("Por favor ingrese su documento");
        return;
      }

      fetch("obtener_cursos.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "documento=" + encodeURIComponent(documento)
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          alert(data.error);
        } else {
          usuarioActual = data.usuario;
          cursosDisponibles = data.cursos;
          mostrarCursos();
        }
      });
    }

    function mostrarCursos() {
      const contenedor = document.getElementById("cursos");
      contenedor.innerHTML = "<h3>Seleccione cursos:</h3>";
      cursosDisponibles.forEach(curso => {
        const input = document.createElement("input");
        input.type = "checkbox";
        input.value = curso.id;
        input.id = "curso_" + curso.id;
        const label = document.createElement("label");
        label.htmlFor = input.id;
        label.innerText = curso.nombre;
        contenedor.appendChild(input);
        contenedor.appendChild(label);
        contenedor.appendChild(document.createElement("br"));
      });

      const boton = document.createElement("button");
      boton.innerText = "Confirmar matrícula";
      boton.onclick = confirmarMatricula;
      contenedor.appendChild(boton);
    }

    function confirmarMatricula() {
      const seleccionados = Array.from(document.querySelectorAll("input[type=checkbox]:checked")).map(i => i.value);

      fetch("registrar_matricula.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: "documento=" + encodeURIComponent(documento.value) + "&cursos[]=" + seleccionados.join("&cursos[]=")
      })
      .then(response => response.json())
      .then(data => {
        alert(data.mensaje || data.error);
      });
    }
  </script>
</head>
<body>
  <h2>Consulta de cursos</h2>
  <label>Documento: <input type="text" id="documento" /></label>
  <button onclick="consultarCursos()">Consultar</button>
  <div id="cursos"></div>
</body>
</html>
