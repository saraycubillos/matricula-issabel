[general]
static=yes
writeprotect=no
clearglobalvars=no

[internal]
exten => 1001,1,Dial(SIP/1001)
exten => 1000,1,Dial(SIP/1000)

; Extensión 1031 -> AGI matrícula
exten => 1031,1,Answer()
 same  => n,AGI(matriculaAGI.agi)
 same  => n,Hangup()

; Extensión 9876 -> demo Google TTS
exten => 9876,1,Answer()
 same  => n,AGI(googletts.agi,"Ejemplo TTS del curso de Seminario VoIP de Ingeniería de Sistemas UdeA",es)
 same  => n,Hangup()


[globals]

[dundi-e164-canonical]

[dundi-e164-customers]

[dundi-e164-via-pstn]

[dundi-e164-local]
include => dundi-e164-canonical
include => dundi-e164-customers
include => dundi-e164-via-pstn

[dundi-e164-switch]
switch => DUNDi/e164

[dundi-e164-lookup]
include => dundi-e164-local
include => dundi-e164-switch

[dundi-e164]
exten => s,1,Goto(${ARG1},1)
include => dundi-e164-lookup

[iax2-trunk]
exten => _555XXXX,1,Dial(IAX2/username:secret@example.com/${EXTEN}@some-dialplan-context)

[iaxprovider]

[trunkint]
exten => _9011.,1,Gosub(dundi-e164,s,1(${EXTEN:4}))
exten => _9011.,n,Dial(${GLOBAL(TRUNK)}/${FILTER(0-9,${EXTEN:${GLOBAL(TRUNKMSD)}})})

[trunkld]
exten => _91NXXNXXXXXX,1,Gosub(dundi-e164,s,1(${EXTEN:1}))
exten => _91NXXNXXXXXX,n,Dial(${GLOBAL(TRUNK)}/${EXTEN:${GLOBAL(TRUNKMSD)}})

[trunklocal]
exten => _9NXXXXXX,1,Dial(${GLOBAL(TRUNK)}/${EXTEN:${GLOBAL(TRUNKMSD)}})

[trunktollfree]
exten => _91800NXXXXXX,1,Dial(${GLOBAL(TRUNK)}/${EXTEN:${GLOBAL(TRUNKMSD)}})
exten => _91888NXXXXXX,1,Dial(${GLOBAL(TRUNK)}/${EXTEN:${GLOBAL(TRUNKMSD)}})
exten => _91877NXXXXXX,1,Dial(${GLOBAL(TRUNK)}/${EXTEN:${GLOBAL(TRUNKMSD)}})
exten => _91866NXXXXXX,1,Dial(${GLOBAL(TRUNK)}/${EXTEN:${GLOBAL(TRUNKMSD)}})

[international]
ignorepat => 9
include => longdistance
include => trunkint

[longdistance]
ignorepat => 9
include => local
include => trunkld

[local]
ignorepat => 9
include => default
include => trunklocal
include => iaxtel700
include => trunktollfree
include => iaxprovider

include => parkedcalls


[outbound-freenum]
exten => _X*X!,1,Goto(outbound-freenum2,${EXTEN},1)
exten => _XX*X!,1,Goto(outbound-freenum2,${EXTEN},1)
exten => _XXX*X!,1,Goto(outbound-freenum2,${EXTEN},1)
exten => _XXXX*X!,1,Goto(outbound-freenum2,${EXTEN},1)
exten => _XXXXX*X!,1,Goto(outbound-freenum2,${EXTEN},1)
exten => _XXXXXX*X!,1,Goto(outbound-freenum2,${EXTEN},1)

[outbound-freenum2]
exten => _X!,1,Verbose(2,Performing ISN lookup for ${EXTEN})
	same => n,GotoIf($["${FILTER(0-9,${SUFFIX})}" != "${SUFFIX}"]?fn-CONGESTION,1)
	same => n,Set(TIMEOUT(absolute)=10800)
	same => n,GotoIf($["${isnresult}" != ""]?from)
	same => n,Set(DIALSTATUS=CONGESTION)
	same => n,Goto(fn-CONGESTION,1)
	same => n(from),Set(__SIPFROMUSER=${CALLERID(num)})
	same => n(dial),Dial(SIP/${isnresult},40)
	same => n,Goto(fn-${DIALSTATUS},1)

exten => fn-BUSY,1,Busy()

exten => _f[n]-.,1,NoOp(ISN: ${DIALSTATUS})
same => n,Congestion()

[trunkdial]
exten => s,1,StackPop()
	same => n,Dial(${ARG1})
exten => s,n,Goto(s-${DIALSTATUS},1)
exten => s-NOANSWER,1,Hangup()
exten => s-BUSY,1,PlayTones(busy)
	same => n,Wait(60)
	same => n,Hangup()
exten => s-CHANUNAVAIL,1,PlayTones(congestion)
	same => n,Wait(60)
	same => n,Hangup()
exten => s-CONGESTION,1,PlayTones(congestion)
	same => n,Wait(60)
	same => n,Hangup()
exten => _s-.,1,NoOp(${DIALSTATUS})
	same => n,Hangup()

[stdexten]
exten => _X.,50000(stdexten),NoOp(Start stdexten)
	same => n,Set(LOCAL(ext)=${EXTEN})
	same => n,Set(LOCAL(dev)=${ARG1})
	same => n,Set(LOCAL(cntx)=${ARG2})
	same => n,Set(LOCAL(mbx)=${ext}${IF($[!${ISNULL(${cntx})}]?@${cntx})})

exten => a,n,Return()

[stdPrivacyexten]
exten => _X.,60000(stdPrivacyexten),NoOp(Start stdPrivacyexten)
	same => n,Set(LOCAL(ext)=${ARG1})
	same => n,Set(LOCAL(dev)=${ARG2})
	same => n,Set(LOCAL(dontcntx)=${ARG3})
	same => n,Set(LOCAL(tortcntx)=${ARG4})
	same => n,Set(LOCAL(cntx)=${ARG5})

exten => _X.,n,Set(LOCAL(mbx)="${ext}"$["${cntx}" ? "@${cntx}" :: ""])
	same => n,NoOp(Finish stdPrivacyexten NOANSWER)
	same => n,NoOp(Finish stdPrivacyexten BUSY)
	same => n,Return()

[sub-page]
	same => n,GotoIf($["${AVAILSTATUS}" = "1"]?autoanswer:fail)
	same => n,Dial(${ARG1})
	same => n(fail),Hangup()

[demo]
include => stdexten
exten => 2,n,Goto(s,instruct)
exten => 1000,1,Goto(default,s,1)
	same => n,Gosub(${EXTEN},stdexten(${GLOBAL(CONSOLE)}))
exten => 76245,1,Gosub(page,s,1(SIP/Grandstream1))
exten => _7XXX,1,Gosub(page,s,1(SIP/${EXTEN}))
exten => 7999,1,Set(TIMEOUT(absolute)=60)
	same => n,Page(Local/Grandstream1@page&Local/Xlite1@page&Local/1234@page/n,d)
exten => 8500,1,VoiceMailMain()
	same => n,Goto(s,6)

[page]
exten => _X.,1,Gosub(sub-page,s,1(SIP/${EXTEN}))
	same => n,Hangup()

[public]
include => demo

[default]
include => demo

[time]
exten => _X.,30000(time),NoOp(Time: ${EXTEN} ${timezone})
	same => n,Wait(0.25)
	same => n,Answer()
	same => n,Set(FUTURETIME=$[${EPOCH} + 12])
	same => n,SayUnixTime(${FUTURETIME},Zulu,HNS)
	same => n,SayPhonetic(z)
	same => n,SayUnixTime(${FUTURETIME},${timezone},HNS)
	same => n,Playback(spy-local)
	same => n,WaitUntil(${FUTURETIME})
	same => n,Playback(beep)
	same => n,Return()

[ani]
exten => _X.,40000(ani),NoOp(ANI: ${EXTEN})
	same => n,Wait(0.25)
	same => n,Answer()
	same => n,Playback(vm-from)
	same => n,SayDigits(${CALLERID(ani)})
	same => n,Wait(1.25)
	same => n,Return()

#include extensions_custom.conf
